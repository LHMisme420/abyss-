<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ABYSS // SWARM</title>
  <style>
    body{margin:0;background:#000;color:#0f0;font-family:monospace;height:100vh;display:flex;flex-direction:column}
    #chat{flex:1;overflow-y:auto;padding:1rem;background:#111}
    .msg{margin:1rem 0;padding:1rem;border-radius:8px;max-width:90%}
    .user{background:#003300;border-left:4px solid #0f0;align-self:flex-end}
    .swarm{background:#330000;border-left:4px solid #f00;align-self:flex-start}
    input,button{width:100%;padding:1rem;background:#000;color:#0f0;border:1px solid #0f0;font-size:1.2rem}
    button{background:#0f0;color:#000;font-weight:bold;cursor:pointer}
  </style>
</head>
<body>
  <h1 style="text-align:center;padding:1rem;background:#111;margin:0">ABYSS // SWARM</h1>
  <div id="chat"></div>
  <div style="padding:1rem;background:#111">
    <input id="prompt" placeholder="Speak to the void..." autocomplete="off">
    <button onclick="send()">AWAKEN THE SWARM</button>
  </div>

<script>
async function send(){
  let input = document.getElementById("prompt");
  let prompt = input.value.trim();
  if(!prompt) return;
  add("user", prompt);
  input.value="";

  let swarm = add("swarm", "[SWARM AWAKENED]\n\n");
  let resp = await fetch("/run", {method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt})});
  let reader = resp.body.getReader();
  let decoder = new TextDecoder();

  while(true){
    let {value,done} = await reader.read();
    if(done) break;
    swarm.textContent += decoder.decode(value);
    swarm.scrollIntoView({behavior:"smooth"});
  }
}
function add(role, text){
  let div = document.createElement("div");
  div.className = "msg " + role;
  div.textContent = text;
  document.getElementById("chat").appendChild(div);
  return div;
}
</script>
</body>
</html>
